# Complete FI-2POP Workflow

## Step-by-Step Guide

### 1ï¸âƒ£ First Time Setup (One-time only)

Generate the level libraries needed for FI-2POP:

```bash
python prepare_initial_population.py
```

**What this does:**
- Creates `random_levels/` with 100 random levels
- Creates `constructive_levels/` with 100 constructive levels  
- Takes ~5-15 minutes depending on your system
- Only needs to be run once

**Output:**
```
ğŸ“ Level libraries created:
   - random_levels/        (100 levels)
   - constructive_levels/  (100 levels)
   - captured_levels/      (200+ levels, already exists)
```

---

### 2ï¸âƒ£ Test the Setup (Optional but recommended)

Quick test to verify everything works:

```bash
python test_captured_in_fi2pop.py
```

**What this does:**
- Checks all three level libraries exist
- Runs a mini FI-2POP evolution (15 population, 3 generations)
- Verifies folder loading works correctly
- Takes ~30 seconds

**Expected output:**
```
âœ… captured_levels       - 200+ files found
âœ… constructive_levels   - 100 files found
âœ… random_levels         - 100 files found
...
âœ… TEST SUCCESSFUL!
```

---

### 3ï¸âƒ£ Run Full FI-2POP Evolution

Generate levels with different target styles:

```bash
python run_fi2pop.py
```

**What this does:**
- Loads ~17 levels from each library (50 total population)
- Evolves for 100 generations per style
- Generates 3 output levels (high_branching, high_linearity, balanced)
- Takes ~10-30 minutes per style

**Output:**
```
generated_levels/
â”œâ”€â”€ fi2pop_high_branching.txt
â”œâ”€â”€ fi2pop_high_linearity.txt
â””â”€â”€ fi2pop_balanced.txt
```

---

### 4ï¸âƒ£ Inspect Results

Visualize generated levels:

```bash
python preview_level.py generated_levels/fi2pop_balanced.txt
```

Check solvability:

```bash
python solvability.py generated_levels/fi2pop_balanced.txt
```

Extract metrics:

```bash
python run_structural_metrics.py
```

---

## Quick Reference Commands

| Task | Command | Time |
|------|---------|------|
| Setup libraries | `python prepare_initial_population.py` | ~5-15 min |
| Quick test | `python test_captured_in_fi2pop.py` | ~30 sec |
| Generate levels | `python run_fi2pop.py` | ~30-90 min |
| Preview level | `python preview_level.py <file>` | instant |
| Check solvability | `python solvability.py <file>` | ~1-5 sec |

---

## Customization

### Generate More Library Levels

```bash
# More diversity in initial population
python prepare_initial_population.py --random 200 --constructive 200
```

### Adjust Evolution Parameters

Edit `run_fi2pop.py`:

```python
cfg = FI2POPConfig(
    population_size=100,    # Bigger population
    max_generations=200,    # More evolution time
    mutation_rate=0.1,      # More mutations
)
```

### Custom Target Metrics

Edit `run_fi2pop.py`:

```python
target_styles = {
    'my_custom_style': {
        'branching': 2.0,      # High branching
        'linearity': 0.5,      # Low linearity
        'dead_end_rate': 0.1,  # Few dead ends
    }
}
```

---

## Troubleshooting

**"Missing level libraries" error:**
```bash
python prepare_initial_population.py
```

**Constructive generation fails:**
- Check `configs/spelunky.json` exists
- Verify: `python -c "from constructive import generate; print('OK')"`

**Low feasible population:**
- Increase population_size
- Generate more constructive levels (they're guaranteed solvable)

**Slow convergence:**
- Increase max_generations
- Adjust mutation/crossover rates
- Check target metrics are realistic

---

## File Organization

```
SAPLG/
â”‚
â”œâ”€â”€ ğŸ“ Level Libraries (input)
â”‚   â”œâ”€â”€ captured_levels/          â† Real Spelunky (already exists)
â”‚   â”œâ”€â”€ constructive_levels/      â† Generated by prepare script
â”‚   â””â”€â”€ random_levels/            â† Generated by prepare script
â”‚
â”œâ”€â”€ ğŸ“ Generated Levels (output)  
â”‚   â””â”€â”€ generated_levels/         â† FI-2POP output
â”‚
â”œâ”€â”€ ğŸ”§ Setup Scripts
â”‚   â”œâ”€â”€ prepare_initial_population.py   â† Run first
â”‚   â”œâ”€â”€ generate_random_levels.py
â”‚   â””â”€â”€ generate_constructive_levels.py
â”‚
â”œâ”€â”€ ğŸ§¬ FI-2POP System
â”‚   â”œâ”€â”€ fi2pop_generator.py       â† Main implementation
â”‚   â”œâ”€â”€ run_fi2pop.py              â† Run this to generate
â”‚   â””â”€â”€ test_captured_in_fi2pop.py â† Quick test
â”‚
â””â”€â”€ ğŸ“š Documentation
    â”œâ”€â”€ FI2POP_SETUP.md
    â””â”€â”€ WORKFLOW.md (this file)
```
