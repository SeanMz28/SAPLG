# SAPLG: Complete FI-2POP Workflow

## Step-by-Step Guide

### 1 First Time Setup (One-time only)

Generate the level libraries needed for FI-2POP:

```bash
python scripts/prepare_initial_population.py
```

**What this does:**
- Creates `random_levels/` with 100 random levels
- Creates `constructive_levels/` with 100 constructive levels  
- Takes ~5-15 minutes depending on your system
- Only needs to be run once

**Output:**
```
 Level libraries created:
   - random_levels/        (100 levels)
   - constructive_levels/  (100 levels)
   - captured_levels/      (200+ levels, already exists)
```

---

### 2 Test the Setup (Optional but recommended)

Quick test to verify everything works:

```bash
python tests/test_captured_in_fi2pop.py
```

**What this does:**
- Checks all three level libraries exist
- Runs a mini FI-2POP evolution (15 population, 3 generations)
- Verifies folder loading works correctly
- Takes ~30 seconds

**Expected output:**
```
 captured_levels       - 200+ files found
 constructive_levels   - 100 files found
 random_levels         - 100 files found
...
 TEST SUCCESSFUL!
```

---

### 3 Run Full FI-2POP Evolution

Generate levels with different target styles:

```bash
python scripts/run_fi2pop.py
```

**What this does:**
- Loads ~17 levels from each library (50 total population)
- Evolves for 100 generations per style
- Generates 3 output levels (high_branching, high_linearity, balanced)
- Takes ~10-30 minutes per style

**Output:**
```
generated_levels/
├── fi2pop_high_branching.txt
├── fi2pop_high_linearity.txt
└── fi2pop_balanced.txt
```

---

### 4 Inspect Results

Visualize generated levels:

```bash
python scripts/preview_level.py generated_levels/fi2pop_balanced.txt
```

Check solvability:

```bash
python src/core/solvability.py generated_levels/fi2pop_balanced.txt
```

Extract metrics:

```bash
python scripts/run_structural_metrics.py
```

---

## Quick Reference Commands

| Task | Command | Time |
|------|---------|------|
| Setup libraries | `python scripts/prepare_initial_population.py` | ~5-15 min |
| Quick test | `python tests/test_captured_in_fi2pop.py` | ~30 sec |
| Generate levels | `python scripts/run_fi2pop.py` | ~30-90 min |
| Preview level | `python scripts/preview_level.py <file>` | instant |
| Check solvability | `python src/core/solvability.py <file>` | ~1-5 sec |

---

## Customization

### Generate More Library Levels

```bash
# More diversity in initial population
python scripts/prepare_initial_population.py --random 200 --constructive 200
```

### Adjust Evolution Parameters

Edit `scripts/run_fi2pop.py`:

```python
cfg = FI2POPConfig(
    population_size=100,    # Bigger population
    max_generations=200,    # More evolution time
    mutation_rate=0.1,      # More mutations
)
```

### Custom Target Metrics

Edit `scripts/run_fi2pop.py`:

```python
target_styles = {
    'my_custom_style': {
        'branching': 2.0,      # High branching
        'linearity': 0.5,      # Low linearity
        'dead_end_rate': 0.1,  # Few dead ends
    }
}
```

---

## Troubleshooting

**"Missing level libraries" error:**
```bash
python scripts/prepare_initial_population.py
```

**Constructive generation fails:**
- Check `configs/spelunky.json` exists
- Verify: `python -c "from src.generators.constructive import generate; print('OK')"`

**Low feasible population:**
- Increase population_size
- Generate more constructive levels (they're guaranteed solvable)

**Slow convergence:**
- Increase max_generations
- Adjust mutation/crossover rates
- Check target metrics are realistic

---

## File Organization

```
SAPLG/
│
├── Level Libraries (input)
│   ├── captured_levels/          ← Real Spelunky (already exists)
│   ├── constructive_levels/      ← Generated by prepare script
│   └── random_levels/            ← Generated by prepare script
│
├── Generated Levels (output)  
│   └── generated_levels/         ← FI-2POP output
│
├── scripts/                      ← Main execution scripts
│   ├── prepare_initial_population.py   ← Run first
│   ├── generate_random_levels.py
│   ├── generate_constructive_levels.py
│   ├── run_fi2pop.py             ← Run this to generate
│   ├── preview_level.py
│   ├── run_structural_metrics.py
│   └── visualize_generated.py
│
├── src/                          ← Core implementation
│   ├── generators/
│   │   └── fi2pop_generator.py   ← Main FI-2POP implementation
│   └── core/
│       └── solvability.py        ← Solvability checking
│
├── tests/                        ← Testing scripts
│   ├── test_captured_in_fi2pop.py ← Quick test
│   └── test_captured_loading.py
│
├── configs/                      ← Configuration files
│   └── spelunky.json
│
├── docs/                         ← Documentation
│   ├── FI2POP_SETUP.md
│   ├── RESULTS_SUMMARY.md
│   └── WORKFLOW.md
│
├── data/                         ← Data files
└── output/                       ← Additional output
```
